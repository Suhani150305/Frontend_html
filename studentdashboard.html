<!--DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduAchieve | Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
        --primary: #2563eb; 
        --danger: #ef4444; 
        --bg: #f0f2f5; 
        --sidebar: #0f172a;
         --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif;
         background: var(--bg);
          margin: 0; 
          display: flex; 
          }

        /* SIDEBAR */
        .sidebar { 
        width: 260px;
         height: 100vh;
          background: 
          var(--sidebar); 
          color: white; 
          position: fixed;
           display: flex; 
           flex-direction: column;
         }
        .sidebar-header { 
            padding: 30px 20px; 
            font-size: 22px;
             font-weight: bold; 
             border-bottom: 1px solid #1e293b; 
             color: var(--primary); 
            }
        .sidebar-menu { flex-grow: 1; padding: 20px 0; }
        .menu-item { 
            width: 100%; border: none; background: none; color: #94a3b8; padding: 15px 25px; 
            display: flex; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s;
        }
        .menu-item:hover, .menu-item.active { background: #1e293b; color: white; border-left: 4px solid var(--primary); }
        .menu-item i { margin-right: 15px; width: 20px; }
        .logout-item { border-top: 1px solid #1e293b; padding: 20px 25px; color: #f87171; text-decoration: none; display: flex; align-items: center; }

        /* MAIN CONTENT */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        .profile-card { background: white; padding: 25px; border-radius: 12px; display: flex; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .profile-info { margin-left: 20px; flex-grow: 1; }
        .profile-info h2 { margin: 0; color: var(--text); }

        /* STATS */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-box h3 { margin: 0; font-size: 28px; color: var(--primary); }

        /* TABLE */
        .content-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; }

        /* ACTION BUTTONS */
        .action-cell { display: flex; gap: 15px; align-items: center; }
        .btn-dl { color: var(--primary); font-size: 18px; text-decoration: none; }
        .btn-delete { color: var(--danger); background: none; border: none; font-size: 18px; cursor: pointer; padding: 0; }
        .btn-delete:hover { color: #b91c1c; }

        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; }
        .modal-body { background: white; padding: 30px; border-radius: 12px; width: 400px; }
        .modal-body input, .modal-body select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">EduAchieve</div>
        <div class="sidebar-menu">
            <button class="menu-item active" onclick="showCategory('All', this)"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="menu-item" onclick="showCategory('Certificate', this)"><i class="fas fa-award"></i> My Certificates</button>
            <button class="menu-item" onclick="showCategory('Internship', this)"><i class="fas fa-user-tie"></i> Internships</button>
            <button class="menu-item" onclick="showCategory('Competition', this)"><i class="fas fa-trophy"></i> Competitions</button>
            <button class="menu-item" onclick="showCategory('Workshop', this)"><i class="fas fa-laptop-code"></i> Workshops</button>
        </div>
        <a href="index.html" class="logout-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        <div class="profile-card">
            <img src="https://ui-avatars.com/api/?name=Rahul+Kumar&background=2563eb&color=fff" class="profile-pic">
            <div class="profile-info">
                <h2>Rahul Kumar</h2>
                <p>B.Tech CSE | 3rd Year | Roll: CS2024</p>
            </div>
            <button class="btn btn-add" onclick="openModal()">+ Add Achievement</button>
        </div>

        <div class="stats-row">
            <div class="stat-box"><h3 id="cnt-all">0</h3><p>Total</p></div>
            <div class="stat-box"><h3 id="cnt-cert">0</h3><p>Certificates</p></div>
            <div class="stat-box"><h3 id="cnt-int">0</h3><p>Internships</p></div>
            <div class="stat-box"><h3 id="cnt-comp">0</h3><p>Competitions</p></div>
        </div>

        <div class="content-box">
            <h3 id="currentCategoryTitle">All Records</h3>
            <table>
                <thead>
                    <tr>
                        <th>Achievement Title</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dataTable"></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-body">
            <h3>New Achievement</h3>
            <form id="achForm">
                <input type="text" id="title" placeholder="Title" required>
                <select id="category">
                    <option value="Certificate">Certificate</option>
                    <option value="Internship">Internship</option>
                    <option value="Competition">Competition</option>
                    <option value="Workshop">Workshop</option>
                </select>
                <input type="date" id="date" required>
                <input type="file" id="file" required>
                <div style="text-align: right; margin-top: 15px;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-add">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Use LocalStorage to persist data
        let data = JSON.parse(localStorage.getItem('achievements')) || [
            { id: Date.now() + 1, title: "Google Cloud Foundations", category: "Certificate", date: "2025-11-10", file: "#" },
            { id: Date.now() + 2, title: "Summer Intern - Microsoft", category: "Internship", date: "2025-08-15", file: "#" }
        ];

        let currentView = 'All';

        function render() {
            const tableBody = document.getElementById('dataTable');
            const filtered = currentView === 'All' ? data : data.filter(item => item.category === currentView);
            
            document.getElementById('currentCategoryTitle').innerText = currentView === 'All' ? "All Records" : currentView + "s";

            tableBody.innerHTML = filtered.map((item) => `
                <tr>
                    <td><strong>${item.title}</strong></td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td class="action-cell">
                        <a href="${item.file}" download class="btn-dl" title="Download"><i class="fas fa-file-download"></i></a>
                        <button class="btn-delete" onclick="deleteAchievement(${item.id})" title="Delete"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `).join('');

            updateCounters();
            localStorage.setItem('achievements', JSON.stringify(data));
        }

        // DELETE FUNCTION
        window.deleteAchievement = (id) => {
            if (confirm("Are you sure you want to delete this record?")) {
                data = data.filter(item => item.id !== id);
                render();
            }
        };

        window.showCategory = (cat, element) => {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            render();
        };

        function updateCounters() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }

        document.getElementById('achForm').onsubmit = function(e) {
            e.preventDefault();
            const fileObj = document.getElementById('file').files[0];
            const fileURL = URL.createObjectURL(fileObj);

            const newItem = {
                id: Date.now(),
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                file: fileURL
            };

            data.unshift(newItem);
            render();
            closeModal();
            this.reset();
        };

        window.onload = render;
    </script>
</body>
</html-->

<!--DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduAchieve | Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --danger: #ef4444; --bg: #f0f2f5; --sidebar: #0f172a; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 260px; height: 100vh; background: var(--sidebar); color: white; position: fixed; display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: bold; border-bottom: 1px solid #1e293b; color: var(--primary); }
        .sidebar-menu { flex-grow: 1; padding: 20px 0; }
        .menu-item { width: 100%; border: none; background: none; color: #94a3b8; padding: 15px 25px; display: flex; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #1e293b; color: white; border-left: 4px solid var(--primary); }
        .menu-item i { margin-right: 15px; width: 20px; }
        .logout-item { border-top: 1px solid #1e293b; padding: 20px 25px; color: #f87171; text-decoration: none; display: flex; align-items: center; }

        /* MAIN CONTENT */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        
        /* PROFILE CARD (With Proctor Info) */
        .profile-card { background: white; padding: 25px; border-radius: 12px; display: flex; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; border-left: 5px solid var(--primary); }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .profile-info { margin-left: 20px; flex-grow: 1; }
        .profile-info h2 { margin: 0; color: var(--text); }
        .profile-info p { margin: 5px 0; color: #64748b; }
        
        .proctor-badge { 
            background: #e0e7ff; color: #3730a3; padding: 8px 12px; 
            border-radius: 8px; font-weight: bold; font-size: 14px; 
            display: inline-flex; align-items: center; gap: 8px; margin-top: 5px;
        }

        /* STATS */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .stat-box:hover { transform: translateY(-5px); }
        .stat-box h3 { margin: 0; font-size: 28px; color: var(--primary); }

        /* TABLE */
        .content-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .desc-text { font-size: 13px; color: #64748b; display: block; margin-top: 4px; max-width: 300px; }

        /* ACTION BUTTONS */
        .action-cell { display: flex; gap: 15px; align-items: center; }
        .btn-dl { color: var(--primary); font-size: 18px; text-decoration: none; }
        .btn-delete { color: var(--danger); background: none; border: none; font-size: 18px; cursor: pointer; padding: 0; }
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; }
        .modal-body { background: white; padding: 30px; border-radius: 12px; width: 450px; }
        .modal-body input, .modal-body select, .modal-body textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">EduAchieve</div>
        <div class="sidebar-menu">
            <button class="menu-item active" onclick="showCategory('All', this)"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="menu-item" onclick="showCategory('Certificate', this)"><i class="fas fa-award"></i> Certificates</button>
            <button class="menu-item" onclick="showCategory('Internship', this)"><i class="fas fa-user-tie"></i> Internships</button>
            <button class="menu-item" onclick="showCategory('Competition', this)"><i class="fas fa-trophy"></i> Competitions</button>
        </div>
        <a href="login.html" class="logout-item" onclick="localStorage.clear()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        <div class="profile-card">
            <img src="https://ui-avatars.com/api/?name=Student&background=2563eb&color=fff" class="profile-pic">
            <div class="profile-info">
                <h2 id="studentName">Student</h2>
                <p id="studentRoll">Roll No: Loading...</p>
                <div class="proctor-badge">
                    <i class="fas fa-chalkboard-teacher"></i> 
                    <span id="proctorName">Fetching Proctor...</span>
                </div>
            </div>
            <button class="btn btn-add" onclick="openModal()">+ Add Achievement</button>
        </div>

        <div class="stats-row">
            <div class="stat-box"><h3 id="cnt-all">0</h3><p>Total</p></div>
            <div class="stat-box"><h3 id="cnt-cert">0</h3><p>Certificates</p></div>
            <div class="stat-box"><h3 id="cnt-int">0</h3><p>Internships</p></div>
            <div class="stat-box"><h3 id="cnt-comp">0</h3><p>Competitions</p></div>
        </div>

        <div class="content-box">
            <h3 id="currentCategoryTitle">All Records</h3>
            <table>
                <thead>
                    <tr>
                        <th>Title & Description</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Proof</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dataTable"></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-body">
            <h3>New Achievement</h3>
            <form id="achForm">
                <input type="text" id="title" placeholder="Achievement Title" required>
                
                <select id="category">
                    <option value="Certificate">Certificate</option>
                    <option value="Internship">Internship</option>
                    <option value="Competition">Competition</option>
                    <option value="Workshop">Workshop</option>
                </select>
                
                <textarea id="desc" rows="3" placeholder="Describe your achievement (Optional)"></textarea>
                
                <input type="date" id="date" required>
                
                <div style="margin: 10px 0; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="hasCert" onchange="toggleFileUpload()" style="width:auto; margin:0;">
                    <label for="hasCert" style="font-size:14px; color:#334155;">I have a certificate/document to upload</label>
                </div>

                <div id="fileUploadContainer" class="hidden">
                    <input type="file" id="file">
                </div>

                <div style="text-align: right; margin-top: 15px;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-add">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000";
        // Get username from login (Roll No)
        const currentUserRoll = localStorage.getItem('username') || "101"; 

        // Local Data for Achievements (Client Side)
        let data = JSON.parse(localStorage.getItem('achievements')) || [];
        let currentView = 'All';

        // --- 1. PROCTOR FETCHING LOGIC ---
        async function loadProfileInfo() {
            document.getElementById('studentRoll').innerText = `Roll No: ${currentUserRoll}`;
            
            try {
                // Fetch Students
                const sRes = await fetch(`${API_URL}/students`);
                const students = await sRes.json();
                const me = students.find(s => s.rollNo === currentUserRoll);

                if (me) {
                    document.getElementById('studentName').innerText = me.name;
                    
                    if (me.proctorId) {
                        // Fetch Faculty to get Proctor Name
                        const fRes = await fetch(`${API_URL}/faculty`);
                        const faculty = await fRes.json();
                        const proctor = faculty.find(f => f._id === me.proctorId);
                        
                        document.getElementById('proctorName').innerText = proctor ? `Proctor: ${proctor.name}` : "Proctor Unknown";
                    } else {
                        document.getElementById('proctorName').innerText = "No Proctor Assigned";
                        document.querySelector('.proctor-badge').style.background = "#fee2e2";
                        document.querySelector('.proctor-badge').style.color = "#b91c1c";
                    }
                } else {
                    document.getElementById('proctorName').innerText = "Student Not Found";
                }
            } catch (error) {
                console.error("Backend Error:", error);
                document.getElementById('proctorName').innerText = "Server Error (Port 5000)";
            }
        }

        // --- 2. ACHIEVEMENT LOGIC ---
        function render() {
            const tableBody = document.getElementById('dataTable');
            const filtered = currentView === 'All' ? data : data.filter(item => item.category === currentView);
            
            document.getElementById('currentCategoryTitle').innerText = currentView === 'All' ? "All Records" : currentView + "s";

            tableBody.innerHTML = filtered.map((item) => `
                <tr>
                    <td>
                        <strong>${item.title}</strong>
                        <span class="desc-text">${item.desc || "No description provided."}</span>
                    </td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td>
                        ${item.hasCert ? `<a href="${item.file}" download class="btn-dl" title="Download"><i class="fas fa-file-pdf"></i></a>` : '<span style="color:#94a3b8; font-size:13px;">No File</span>'}
                    </td>
                    <td class="action-cell">
                        <button class="btn-delete" onclick="deleteAchievement(${item.id})" title="Delete"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `).join('');

            updateCounters();
            localStorage.setItem('achievements', JSON.stringify(data));
        }

        window.deleteAchievement = (id) => {
            if (confirm("Delete this record?")) {
                data = data.filter(item => item.id !== id);
                render();
            }
        };

        window.showCategory = (cat, element) => {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            render();
        };

        function updateCounters() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        // MODAL LOGIC
        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }
        
        function toggleFileUpload() {
            const isChecked = document.getElementById('hasCert').checked;
            const container = document.getElementById('fileUploadContainer');
            if (isChecked) container.classList.remove('hidden');
            else container.classList.add('hidden');
        }

        document.getElementById('achForm').onsubmit = function(e) {
            e.preventDefault();
            
            const hasCert = document.getElementById('hasCert').checked;
            let fileURL = "#";

            if(hasCert) {
                const fileObj = document.getElementById('file').files[0];
                if(fileObj) fileURL = URL.createObjectURL(fileObj);
            }

            const newItem = {
                id: Date.now(),
                title: document.getElementById('title').value,
                desc: document.getElementById('desc').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                hasCert: hasCert,
                file: fileURL
            };

            data.unshift(newItem);
            render();
            closeModal();
            this.reset();
            document.getElementById('fileUploadContainer').classList.add('hidden'); // Reset UI
        };

        window.onload = function() {
            render();
            loadProfileInfo(); // Fetch Proctor on Load
        };
    </script>
</body>
</html-->

<!--DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduAchieve | Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --bg: #f0f2f5; --sidebar: #0f172a; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 260px; height: 100vh; background: var(--sidebar); color: white; position: fixed; display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: bold; border-bottom: 1px solid #1e293b; color: var(--primary); }
        .sidebar-menu { flex-grow: 1; padding: 20px 0; }
        .menu-item { width: 100%; border: none; background: none; color: #94a3b8; padding: 15px 25px; display: flex; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #1e293b; color: white; border-left: 4px solid var(--primary); }
        .menu-item i { margin-right: 15px; width: 20px; }
        .logout-item { border-top: 1px solid #1e293b; padding: 20px 25px; color: #f87171; text-decoration: none; display: flex; align-items: center; cursor: pointer; }

        /* MAIN CONTENT */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        
        /* PROFILE CARD (Dynamic) */
        .profile-card { 
            background: white; padding: 25px; border-radius: 12px; display: flex; align-items: center; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; border-left: 5px solid var(--primary); 
        }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .profile-info { margin-left: 20px; flex-grow: 1; }
        .profile-info h2 { margin: 0; color: var(--text); font-size: 24px; }
        .profile-info p { margin: 5px 0; color: #64748b; font-size: 14px; }
        
        /* PROCTOR BADGE */
        .proctor-badge { 
            background: #e0e7ff; color: #3730a3; padding: 8px 12px; 
            border-radius: 8px; font-weight: bold; font-size: 14px; 
            display: inline-flex; align-items: center; gap: 8px; margin-top: 10px;
        }

        /* STATS */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-box h3 { margin: 0; font-size: 28px; color: var(--primary); }

        /* CONTENT */
        .content-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .desc-text { font-size: 12px; color: #64748b; display: block; margin-top: 4px; font-style: italic; }

        /* BUTTONS */
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--primary); color: white; }
        .btn-delete { color: #ef4444; background: none; font-size: 16px; cursor: pointer; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-body { background: white; padding: 30px; border-radius: 12px; width: 450px; }
        .modal-body input, .modal-body select, .modal-body textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">EduAchieve</div>
        <div class="sidebar-menu">
            <button class="menu-item active" onclick="showCategory('All', this)"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="menu-item" onclick="showCategory('Certificate', this)"><i class="fas fa-award"></i> Certificates</button>
            <button class="menu-item" onclick="showCategory('Internship', this)"><i class="fas fa-user-tie"></i> Internships</button>
            <button class="menu-item" onclick="showCategory('Competition', this)"><i class="fas fa-trophy"></i> Competitions</button>
        </div>
        <a class="logout-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        <div class="profile-card">
            <img src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" class="profile-pic" id="profilePic">
            <div class="profile-info">
                <h2 id="studentName">Loading Student...</h2>
                <p id="studentDetails">Fetching details...</p>
                
                <div class="proctor-badge" id="proctorBadge">
                    <i class="fas fa-chalkboard-teacher"></i> 
                    <span id="proctorName">Fetching Proctor...</span>
                </div>
            </div>
            <button class="btn btn-add" onclick="openModal()">+ Add Achievement</button>
        </div>

        <div class="stats-row">
            <div class="stat-box"><h3 id="cnt-all">0</h3><p>Total</p></div>
            <div class="stat-box"><h3 id="cnt-cert">0</h3><p>Certificates</p></div>
            <div class="stat-box"><h3 id="cnt-int">0</h3><p>Internships</p></div>
            <div class="stat-box"><h3 id="cnt-comp">0</h3><p>Competitions</p></div>
        </div>

        <div class="content-box">
            <h3 id="currentCategoryTitle">All Records</h3>
            <table>
                <thead>
                    <tr>
                        <th>Title & Description</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Proof</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dataTable"></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-body">
            <h3>New Achievement</h3>
            <form id="achForm">
                <input type="text" id="title" placeholder="Achievement Title" required>
                
                <select id="category">
                    <option value="Certificate">Certificate</option>
                    <option value="Internship">Internship</option>
                    <option value="Competition">Competition</option>
                    <option value="Workshop">Workshop</option>
                </select>
                
                <textarea id="desc" rows="3" placeholder="Describe your achievement (Optional)"></textarea>
                
                <input type="date" id="date" required>
                
                <div style="margin: 10px 0; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="hasCert" onchange="toggleFileUpload()" style="width:auto; margin:0;">
                    <label for="hasCert" style="font-size:14px;">I have a certificate/document to upload</label>
                </div>

                <div id="fileUploadContainer" class="hidden">
                    <input type="file" id="file">
                </div>

                <div style="text-align: right; margin-top: 15px;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-add">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000";
        // 1. GET LOGGED IN USER (Stored during Login)
        const myRollNo = localStorage.getItem('username');

        // Local Data for Achievements (In real app, this would also go to DB)
        let data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
        let currentView = 'All';

        // --- FETCH STUDENT & PROCTOR INFO ---
        async function loadProfile() {
            if (!myRollNo) {
                alert("Please Login First!");
                window.location.href = "login.html";
                return;
            }

            try {
                // Fetch All Students & Faculty from Admin Backend
                const [sRes, fRes] = await Promise.all([
                    fetch(`${API_URL}/students`),
                    fetch(`${API_URL}/faculty`)
                ]);

                const students = await sRes.json();
                const faculty = await fRes.json();

                // Find ME (The Logged In Student)
                const me = students.find(s => s.rollNo === myRollNo);

                if (me) {
                    // Update Profile UI
                    document.getElementById('studentName').innerText = me.name;
                    document.getElementById('studentDetails').innerText = `${me.dept} Dept | Semester ${me.sem} | Roll: ${me.rollNo}`;
                    document.getElementById('profilePic').src = `https://ui-avatars.com/api/?name=${me.name}&background=2563eb&color=fff`;

                    // Find My Proctor
                    if (me.proctorId) {
                        const myProctor = faculty.find(f => f._id === me.proctorId);
                        if (myProctor) {
                            document.getElementById('proctorName').innerText = `Proctor: ${myProctor.name}`;
                        } else {
                            document.getElementById('proctorName').innerText = "Proctor ID Found (But Faculty Deleted)";
                        }
                    } else {
                        document.getElementById('proctorName').innerText = "No Proctor Assigned Yet";
                        document.getElementById('proctorBadge').style.background = "#fee2e2";
                        document.getElementById('proctorBadge').style.color = "#b91c1c";
                    }
                } else {
                    document.getElementById('studentName').innerText = "Student Not Found";
                    alert("Your Roll Number doesn't exist in the database. Contact Admin.");
                }

            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('proctorName').innerText = "Server Connection Failed";
            }
        }

        // --- ACHIEVEMENT LOGIC ---
        function render() {
            const tableBody = document.getElementById('dataTable');
            const filtered = currentView === 'All' ? data : data.filter(item => item.category === currentView);
            
            document.getElementById('currentCategoryTitle').innerText = currentView === 'All' ? "All Records" : currentView + "s";

            tableBody.innerHTML = filtered.map((item) => `
                <tr>
                    <td>
                        <strong>${item.title}</strong>
                        <span class="desc-text">${item.desc || "No description provided."}</span>
                    </td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td>
                        ${item.hasCert ? `<a href="#" style="color:#2563eb"><i class="fas fa-file-alt"></i> View</a>` : '<span style="color:#94a3b8;">No File</span>'}
                    </td>
                    <td>
                        <button class="btn-delete" onclick="deleteAchievement(${item.id})"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `).join('');

            updateCounters();
            // Save data specifically for THIS student
            localStorage.setItem(`achievements_${myRollNo}`, JSON.stringify(data));
        }

        window.deleteAchievement = (id) => {
            if (confirm("Delete this record?")) {
                data = data.filter(item => item.id !== id);
                render();
            }
        };

        window.showCategory = (cat, element) => {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            render();
        };

        function updateCounters() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }
        
        function toggleFileUpload() {
            const isChecked = document.getElementById('hasCert').checked;
            const container = document.getElementById('fileUploadContainer');
            isChecked ? container.classList.remove('hidden') : container.classList.add('hidden');
        }

        document.getElementById('achForm').onsubmit = function(e) {
            e.preventDefault();
            const hasCert = document.getElementById('hasCert').checked;
            
            const newItem = {
                id: Date.now(),
                title: document.getElementById('title').value,
                desc: document.getElementById('desc').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                hasCert: hasCert,
                file: "dummy_link.pdf" // In real app, upload to server
            };

            data.unshift(newItem);
            render();
            closeModal();
            this.reset();
            document.getElementById('fileUploadContainer').classList.add('hidden');
        };

        function logout() {
            localStorage.removeItem('username');
            localStorage.removeItem('userRole');
            window.location.href = "login.html";
        }

        // Initialize
        window.onload = function() {
            render();
            loadProfile();
        };
    </script>
</body>
</html-->


<!--DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduAchieve | Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --bg: #f0f2f5; --sidebar: #0f172a; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 260px; height: 100vh; background: var(--sidebar); color: white; position: fixed; display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: bold; border-bottom: 1px solid #1e293b; color: var(--primary); }
        .sidebar-menu { flex-grow: 1; padding: 20px 0; }
        .menu-item { width: 100%; border: none; background: none; color: #94a3b8; padding: 15px 25px; display: flex; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #1e293b; color: white; border-left: 4px solid var(--primary); }
        .menu-item i { margin-right: 15px; width: 20px; }
        .logout-item { border-top: 1px solid #1e293b; padding: 20px 25px; color: #f87171; text-decoration: none; display: flex; align-items: center; cursor: pointer; }

        /* MAIN CONTENT */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        
        /* PROFILE CARD (Dynamic) */
        .profile-card { 
            background: white; padding: 25px; border-radius: 12px; display: flex; align-items: center; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; border-left: 5px solid var(--primary); 
        }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .profile-info { margin-left: 20px; flex-grow: 1; }
        .profile-info h2 { margin: 0; color: var(--text); font-size: 24px; }
        .profile-info p { margin: 5px 0; color: #64748b; font-size: 14px; }
        
        /* PROCTOR BADGE */
        .proctor-badge { 
            background: #e0e7ff; color: #3730a3; padding: 8px 12px; 
            border-radius: 8px; font-weight: bold; font-size: 14px; 
            display: inline-flex; align-items: center; gap: 8px; margin-top: 10px;
        }

        /* STATS */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-box h3 { margin: 0; font-size: 28px; color: var(--primary); }

        /* CONTENT */
        .content-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .desc-text { font-size: 12px; color: #64748b; display: block; margin-top: 4px; font-style: italic; }

        /* BUTTONS */
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--primary); color: white; }
        .btn-delete { color: #ef4444; background: none; font-size: 16px; cursor: pointer; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-body { background: white; padding: 30px; border-radius: 12px; width: 450px; }
        .modal-body input, .modal-body select, .modal-body textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">EduAchieve</div>
        <div class="sidebar-menu">
            <button class="menu-item active" onclick="showCategory('All', this)"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="menu-item" onclick="showCategory('Certificate', this)"><i class="fas fa-award"></i> Certificates</button>
            <button class="menu-item" onclick="showCategory('Internship', this)"><i class="fas fa-user-tie"></i> Internships</button>
            <button class="menu-item" onclick="showCategory('Competition', this)"><i class="fas fa-trophy"></i> Competitions</button>
        </div>
        <a class="logout-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        <div class="profile-card">
            <img src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" class="profile-pic" id="profilePic">
            <div class="profile-info">
                <h2 id="studentName">Loading Student...</h2>
                <p id="studentDetails">Fetching details...</p>
                
                <div class="proctor-badge" id="proctorBadge">
                    <i class="fas fa-chalkboard-teacher"></i> 
                    <span id="proctorName">Fetching Proctor...</span>
                </div>
            </div>
            <button class="btn btn-add" onclick="openModal()">+ Add Achievement</button>
        </div>

        <div class="stats-row">
            <div class="stat-box"><h3 id="cnt-all">0</h3><p>Total</p></div>
            <div class="stat-box"><h3 id="cnt-cert">0</h3><p>Certificates</p></div>
            <div class="stat-box"><h3 id="cnt-int">0</h3><p>Internships</p></div>
            <div class="stat-box"><h3 id="cnt-comp">0</h3><p>Competitions</p></div>
        </div>

        <div class="content-box">
            <h3 id="currentCategoryTitle">All Records</h3>
            <table>
                <thead>
                    <tr>
                        <th>Title & Description</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Proof</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dataTable"></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-body">
            <h3>New Achievement</h3>
            <form id="achForm">
                <input type="text" id="title" placeholder="Achievement Title" required>
                
                <select id="category">
                    <option value="Certificate">Certificate</option>
                    <option value="Internship">Internship</option>
                    <option value="Competition">Competition</option>
                    <option value="Workshop">Workshop</option>
                </select>
                
                <textarea id="desc" rows="3" placeholder="Describe your achievement (Optional)"></textarea>
                
                <input type="date" id="date" required>
                
                <div style="margin: 10px 0; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="hasCert" onchange="toggleFileUpload()" style="width:auto; margin:0;">
                    <label for="hasCert" style="font-size:14px;">I have a certificate/document to upload</label>
                </div>

                <div id="fileUploadContainer" class="hidden">
                    <input type="file" id="file">
                </div>

                <div style="text-align: right; margin-top: 15px;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-add">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000";
        
        // 1. GET LOGGED IN USER FROM LOCAL STORAGE
        // This was saved when you clicked "Login" on the previous page
        const myRollNo = localStorage.getItem('username');

        // Local Data for Achievements (In real app, this would also go to DB)
        let data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
        let currentView = 'All';

        // --- FETCH STUDENT & PROCTOR INFO ---
        async function loadProfile() {
            // Check if user is logged in
            if (!myRollNo) {
                alert("Please Login First!");
                window.location.href = "login.html";
                return;
            }

            try {
                // Fetch All Students & Faculty from Admin Backend
                const [sRes, fRes] = await Promise.all([
                    fetch(`${API_URL}/students`),
                    fetch(`${API_URL}/faculty`)
                ]);

                if (!sRes.ok || !fRes.ok) throw new Error("Failed to fetch data");

                const students = await sRes.json();
                const faculty = await fRes.json();

                // Find ME (The Logged In Student) by comparing Roll Numbers
                // Using String() ensures we match even if one is text and one is number
                const me = students.find(s => String(s.rollNo).trim() === String(myRollNo).trim());

                if (me) {
                    // Update Profile UI with DB data
                    document.getElementById('studentName').innerText = me.name;
                    document.getElementById('studentDetails').innerText = `${me.dept} Dept | Semester ${me.sem} | Roll: ${me.rollNo}`;
                    document.getElementById('profilePic').src = `https://ui-avatars.com/api/?name=${me.name}&background=2563eb&color=fff`;

                    // Find My Proctor using proctorId
                    if (me.proctorId) {
                        const myProctor = faculty.find(f => f._id === me.proctorId);
                        if (myProctor) {
                            document.getElementById('proctorName').innerText = `Proctor: ${myProctor.name}`;
                        } else {
                            document.getElementById('proctorName').innerText = "Proctor ID Found (But Faculty Deleted)";
                        }
                    } else {
                        document.getElementById('proctorName').innerText = "No Proctor Assigned Yet";
                        document.getElementById('proctorBadge').style.background = "#fee2e2";
                        document.getElementById('proctorBadge').style.color = "#b91c1c";
                    }
                } else {
                    document.getElementById('studentName').innerText = "Student Not Found";
                    document.getElementById('studentDetails').innerText = "Roll No: " + myRollNo;
                    alert("Your Roll Number doesn't exist in the database. Contact Admin.");
                }

            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('proctorName').innerText = "Server Connection Failed";
                document.getElementById('studentName').innerText = "Connection Error";
            }
        }

        // --- ACHIEVEMENT LOGIC ---
        function render() {
            const tableBody = document.getElementById('dataTable');
            const filtered = currentView === 'All' ? data : data.filter(item => item.category === currentView);
            
            document.getElementById('currentCategoryTitle').innerText = currentView === 'All' ? "All Records" : currentView + "s";

            tableBody.innerHTML = filtered.map((item) => `
                <tr>
                    <td>
                        <strong>${item.title}</strong>
                        <span class="desc-text">${item.desc || "No description provided."}</span>
                    </td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td>
                        ${item.hasCert ? `<a href="#" style="color:#2563eb"><i class="fas fa-file-alt"></i> View</a>` : '<span style="color:#94a3b8;">No File</span>'}
                    </td>
                    <td>
                        <button class="btn-delete" onclick="deleteAchievement(${item.id})"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `).join('');

            updateCounters();
            // Save data specifically for THIS student
            if(myRollNo) {
                localStorage.setItem(`achievements_${myRollNo}`, JSON.stringify(data));
            }
        }

        window.deleteAchievement = (id) => {
            if (confirm("Delete this record?")) {
                data = data.filter(item => item.id !== id);
                render();
            }
        };

        window.showCategory = (cat, element) => {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            render();
        };

        function updateCounters() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }
        
        function toggleFileUpload() {
            const isChecked = document.getElementById('hasCert').checked;
            const container = document.getElementById('fileUploadContainer');
            isChecked ? container.classList.remove('hidden') : container.classList.add('hidden');
        }

        document.getElementById('achForm').onsubmit = function(e) {
            e.preventDefault();
            const hasCert = document.getElementById('hasCert').checked;
            
            const newItem = {
                id: Date.now(),
                title: document.getElementById('title').value,
                desc: document.getElementById('desc').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                hasCert: hasCert,
                file: "dummy_link.pdf" // In real app, upload to server
            };

            data.unshift(newItem);
            render();
            closeModal();
            this.reset();
            document.getElementById('fileUploadContainer').classList.add('hidden');
        };

        function logout() {
            localStorage.removeItem('username');
            localStorage.removeItem('userRole');
            window.location.href = "login.html";
        }

        // Initialize
        window.onload = function() {
            loadProfile(); // Load Student Info from Server
            render();      // Render Achievements
        };
    </script>
</body>
</html-->



<!--DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduAchieve | Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --bg: #f0f2f5; --sidebar: #0f172a; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 260px; height: 100vh; background: var(--sidebar); color: white; position: fixed; display: flex; flex-direction: column; z-index: 100; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: bold; border-bottom: 1px solid #1e293b; color: var(--primary); }
        .sidebar-menu { flex-grow: 1; padding: 20px 0; }
        .menu-item { width: 100%; border: none; background: none; color: #94a3b8; padding: 15px 25px; display: flex; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #1e293b; color: white; border-left: 4px solid var(--primary); }
        .menu-item i { margin-right: 15px; width: 20px; }
        .logout-item { border-top: 1px solid #1e293b; padding: 20px 25px; color: #f87171; text-decoration: none; display: flex; align-items: center; cursor: pointer; }

        /* MAIN CONTENT */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        
        /* PROFILE CARD */
        .profile-card { 
            background: white; padding: 25px; border-radius: 12px; display: flex; align-items: center; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; border-left: 5px solid var(--primary); 
        }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .profile-info { margin-left: 20px; flex-grow: 1; }
        .profile-info h2 { margin: 0; color: var(--text); font-size: 24px; }
        .profile-info p { margin: 5px 0; color: #64748b; font-size: 14px; }
        
        .proctor-badge { 
            background: #e0e7ff; color: #3730a3; padding: 8px 12px; 
            border-radius: 8px; font-weight: bold; font-size: 14px; 
            display: inline-flex; align-items: center; gap: 8px; margin-top: 10px;
        }

        /* STATS */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-box h3 { margin: 0; font-size: 28px; color: var(--primary); }

        /* CONTENT & FORMS */
        .content-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        
        /* SECURITY FORM */
        .security-box { max-width: 500px; margin: 0 auto; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #475569; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .desc-text { font-size: 12px; color: #64748b; display: block; margin-top: 4px; font-style: italic; }

        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-add:hover { background: #1d4ed8; }
        .btn-delete { color: #ef4444; background: none; font-size: 16px; cursor: pointer; }

        /* MODAL & UTILS */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; }
        .modal-body { background: white; padding: 30px; border-radius: 12px; width: 450px; }
        .modal-body input, .modal-body select, .modal-body textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">EduAchieve</div>
        <div class="sidebar-menu">
            <button class="menu-item active" onclick="showCategory('All', this)"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="menu-item" onclick="showCategory('Certificate', this)"><i class="fas fa-award"></i> Certificates</button>
            <button class="menu-item" onclick="showCategory('Internship', this)"><i class="fas fa-user-tie"></i> Internships</button>
            <button class="menu-item" onclick="showCategory('Competition', this)"><i class="fas fa-trophy"></i> Competitions</button>
            
            <button class="menu-item" onclick="showSecurity(this)"><i class="fas fa-lock"></i> Security</button>
        </div>
        <a class="logout-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        
        <div id="dashboard-view">
            <div class="profile-card">
                <img src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" class="profile-pic" id="profilePic">
                <div class="profile-info">
                    <h2 id="studentName">Loading...</h2>
                    <p id="studentDetails">Fetching details...</p>
                    
                    <div class="proctor-badge" id="proctorBadge">
                        <i class="fas fa-chalkboard-teacher"></i> 
                        <span id="proctorName">Fetching Proctor...</span>
                    </div>
                </div>
                <button class="btn btn-add" onclick="openModal()">+ Add Achievement</button>
            </div>

            <div class="stats-row">
                <div class="stat-box"><h3 id="cnt-all">0</h3><p>Total</p></div>
                <div class="stat-box"><h3 id="cnt-cert">0</h3><p>Certificates</p></div>
                <div class="stat-box"><h3 id="cnt-int">0</h3><p>Internships</p></div>
                <div class="stat-box"><h3 id="cnt-comp">0</h3><p>Competitions</p></div>
            </div>

            <div class="content-box">
                <h3 id="currentCategoryTitle">All Records</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Title & Description</th>
                            <th>Category</th>
                            <th>Date</th>
                            <th>Proof</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable"></tbody>
                </table>
            </div>
        </div>

        <div id="security-view" class="hidden">
            <div class="content-box security-box">
                <h3 style="color:#2563eb; margin-top:0; border-bottom:1px solid #f1f5f9; padding-bottom:15px; margin-bottom:20px;">
                    <i class="fas fa-key"></i> Change Password
                </h3>
                
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="oldPass" placeholder="Enter current password">
                </div>
                
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPass" placeholder="Enter new password">
                </div>
                
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPass" placeholder="Re-enter new password">
                </div>
                
                <button class="btn btn-add" style="width:100%; padding:15px;" onclick="changePassword()">Update Password</button>
            </div>
        </div>

    </div>

    <div class="modal" id="addModal">
        <div class="modal-body">
            <h3>New Achievement</h3>
            <form id="achForm">
                <input type="text" id="title" placeholder="Achievement Title" required>
                <select id="category">
                    <option value="Certificate">Certificate</option>
                    <option value="Internship">Internship</option>
                    <option value="Competition">Competition</option>
                    <option value="Workshop">Workshop</option>
                </select>
                <textarea id="desc" rows="3" placeholder="Describe your achievement (Optional)"></textarea>
                <input type="date" id="date" required>
                
                <div style="margin: 10px 0; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="hasCert" onchange="toggleFileUpload()" style="width:auto; margin:0;">
                    <label for="hasCert" style="font-size:14px;">I have a document to upload</label>
                </div>

                <div id="fileUploadContainer" class="hidden">
                    <input type="file" id="file">
                </div>

                <div style="text-align: right; margin-top: 15px;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-add">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000";
        const myRollNo = localStorage.getItem('username');
        let data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
        let currentView = 'All';

        // --- NAVIGATION ---
        function showSecurity(btn) {
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('security-view').classList.remove('hidden');
        }

        window.showCategory = (cat, btn) => {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Show Dashboard, Hide Security
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('security-view').classList.add('hidden');
            render();
        };

        // --- PROFILE & PROCTOR ---
        async function loadProfile() {
            if (!myRollNo) {
                alert("Please Login First!");
                window.location.href = "login.html";
                return;
            }

            try {
                const [sRes, fRes] = await Promise.all([ fetch(`${API_URL}/students`), fetch(`${API_URL}/faculty`) ]);
                const students = await sRes.json();
                const faculty = await fRes.json();
                
                const me = students.find(s => String(s.rollNo).trim() === String(myRollNo).trim());

                if (me) {
                    document.getElementById('studentName').innerText = me.name;
                    document.getElementById('studentDetails').innerText = `${me.dept} | Sem ${me.sem} | Roll: ${me.rollNo}`;
                    document.getElementById('profilePic').src = `https://ui-avatars.com/api/?name=${me.name}&background=2563eb&color=fff`;

                    if (me.proctorId) {
                        const myProctor = faculty.find(f => f._id === me.proctorId);
                        const pName = myProctor ? myProctor.name : "Proctor Not Found";
                        document.getElementById('proctorName').innerText = `Proctor: ${pName}`;
                    } else {
                        document.getElementById('proctorName').innerText = "No Proctor Assigned";
                        document.getElementById('proctorBadge').style.background = "#fee2e2";
                        document.getElementById('proctorBadge').style.color = "#b91c1c";
                    }
                } else {
                    document.getElementById('studentName').innerText = "Student Not Found";
                }
            } catch (error) { console.error("Error:", error); }
        }

        // --- PASSWORD RESET LOGIC ---
        async function changePassword() {
            const oldPass = document.getElementById('oldPass').value;
            const newPass = document.getElementById('newPass').value;
            const confirmPass = document.getElementById('confirmPass').value;

            if(!oldPass || !newPass) return alert("Please fill all fields");
            if(newPass !== confirmPass) return alert("New passwords do not match!");

            try {
                // 1. Verify Old Password
                const verifyRes = await fetch(`${API_URL}/login`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: myRollNo, password: oldPass, role: 'student' })
                });

                if(!verifyRes.ok) return alert("Incorrect Current Password!");

                // 2. Update to New Password
                const updateRes = await fetch(`${API_URL}/admin/update-user`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: myRollNo, password: newPass })
                });

                if(updateRes.ok) {
                    alert("Password Changed Successfully! Please Login again.");
                    logout();
                } else {
                    alert("Failed to update password.");
                }
            } catch(e) { alert("Server Error"); }
        }

        // --- ACHIEVEMENTS ---
        function render() {
            const tableBody = document.getElementById('dataTable');
            const filtered = currentView === 'All' ? data : data.filter(item => item.category === currentView);
            document.getElementById('currentCategoryTitle').innerText = currentView === 'All' ? "All Records" : currentView + "s";

            tableBody.innerHTML = filtered.map((item) => `
                <tr>
                    <td><strong>${item.title}</strong><span class="desc-text">${item.desc || ""}</span></td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td>${item.hasCert ? `<a href="#" style="color:#2563eb"><i class="fas fa-file-alt"></i> View</a>` : '<span style="color:#94a3b8;">No File</span>'}</td>
                    <td><button class="btn-delete" onclick="deleteAchievement(${item.id})"><i class="fas fa-trash-alt"></i></button></td>
                </tr>
            `).join('');

            updateCounters();
            if(myRollNo) localStorage.setItem(`achievements_${myRollNo}`, JSON.stringify(data));
        }

        window.deleteAchievement = (id) => {
            if (confirm("Delete this record?")) { data = data.filter(item => item.id !== id); render(); }
        };

        function updateCounters() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }
        function toggleFileUpload() {
            const isChecked = document.getElementById('hasCert').checked;
            document.getElementById('fileUploadContainer').classList.toggle('hidden', !isChecked);
        }

        document.getElementById('achForm').onsubmit = function(e) {
            e.preventDefault();
            const hasCert = document.getElementById('hasCert').checked;
            const newItem = {
                id: Date.now(),
                title: document.getElementById('title').value,
                desc: document.getElementById('desc').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                hasCert: hasCert,
                file: "dummy_link.pdf"
            };
            data.unshift(newItem);
            render();
            closeModal();
            this.reset();
            document.getElementById('fileUploadContainer').classList.add('hidden');
        };

        function logout() {
            localStorage.clear();
            window.location.href = "login.html";
        }

        window.onload = function() {
            loadProfile();
            render();
        };
    </script>
</body>
</html-->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduAchieve | Student Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --bg: #f0f2f5; --sidebar: #0f172a; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }

        /* SIDEBAR */
        .sidebar { width: 260px; height: 100vh; background: var(--sidebar); color: white; position: fixed; display: flex; flex-direction: column; z-index: 100; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: bold; border-bottom: 1px solid #1e293b; color: var(--primary); }
        .sidebar-menu { flex-grow: 1; padding: 20px 0; }
        .menu-item { width: 100%; border: none; background: none; color: #94a3b8; padding: 15px 25px; display: flex; align-items: center; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #1e293b; color: white; border-left: 4px solid var(--primary); }
        .menu-item i { margin-right: 15px; width: 20px; }
        .logout-item { border-top: 1px solid #1e293b; padding: 20px 25px; color: #f87171; text-decoration: none; display: flex; align-items: center; cursor: pointer; }

        /* MAIN CONTENT */
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        .profile-card { background: white; padding: 25px; border-radius: 12px; display: flex; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; border-left: 5px solid var(--primary); }
        .profile-pic { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .profile-info { margin-left: 20px; flex-grow: 1; }
        .profile-info h2 { margin: 0; color: var(--text); font-size: 24px; }
        .proctor-badge { background: #e0e7ff; color: #3730a3; padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 14px; display: inline-flex; align-items: center; gap: 8px; margin-top: 10px; }

        /* STATS */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-box h3 { margin: 0; font-size: 28px; color: var(--primary); }

        /* CONTENT */
        .content-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .search-bar { padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 250px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }

        /* BUTTONS */
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; }
        .btn-add { background: var(--primary); color: white; }
        .action-btn { background: none; border: none; cursor: pointer; font-size: 16px; margin: 0 5px; transition: 0.2s; }
        .btn-view { color: #2563eb; }
        .btn-download { color: #10b981; }
        .btn-edit { color: #f59e0b; }
        .btn-delete { color: #ef4444; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; }
        .modal-body { background: white; padding: 30px; border-radius: 12px; width: 450px; }
        .modal-body input, .modal-body select, .modal-body textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .hidden { display: none !important; }
       
        /* SECURITY FORM */
        .security-box { max-width: 500px; margin: 0 auto; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #475569; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .desc-text { font-size: 12px; color: #64748b; display: block; margin-top: 4px; font-style: italic; }

        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-add:hover { background: #1d4ed8; }
        .btn-delete { color: #ef4444; background: none; font-size: 16px; cursor: pointer; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">EduAchieve</div>
        <div class="sidebar-menu">
            <button class="menu-item active" onclick="showCategory('All', this)"><i class="fas fa-th-large"></i> Dashboard</button>
            <button class="menu-item" onclick="showCategory('Certificate', this)"><i class="fas fa-award"></i> Certificates</button>
            <button class="menu-item" onclick="showCategory('Internship', this)"><i class="fas fa-user-tie"></i> Internships</button>
            <button class="menu-item" onclick="showCategory('Competition', this)"><i class="fas fa-trophy"></i> Competitions</button>
            <button class="menu-item" onclick="toggleSecurityView(this)"><i class="fas fa-lock"></i> Security</button>
        </div>
        <a class="logout-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        <div id="dashboard-view">
            <div class="profile-card">
                <img src="" class="profile-pic" id="profilePic">
                <div class="profile-info">
                    <h2 id="studentName">Loading...</h2>
                    <p id="studentDetails">Fetching details...</p>
                    <div class="proctor-badge" id="proctorBadge">
                        <i class="fas fa-chalkboard-teacher"></i> <span id="proctorName">Fetching...</span>
                    </div>
                </div>
                <button class="btn btn-add" onclick="openModal()">+ Add Achievement</button>
            </div>

            <div class="stats-row">
                <div class="stat-box"><h3 id="cnt-all">0</h3><p>Total</p></div>
                <div class="stat-box"><h3 id="cnt-cert">0</h3><p>Certificates</p></div>
                <div class="stat-box"><h3 id="cnt-int">0</h3><p>Internships</p></div>
                <div class="stat-box"><h3 id="cnt-comp">0</h3><p>Competitions</p></div>
            </div>

            <div class="content-box">
                <div class="table-header">
                    <h3 id="currentCategoryTitle">All Records</h3>
                    <input type="text" id="tableSearch" class="search-bar" placeholder="Search records..." onkeyup="render()">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Title & Description</th>
                            <th>Category</th>
                            <th>Date</th>
                            <th>Proof</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable"></tbody>
                </table>
            </div>
        </div>

        <div id="security-view" class="hidden">
            <div class="content-box security-box">
                <h3 style="color:#2563eb; margin-top:0; border-bottom:1px solid #f1f5f9; padding-bottom:15px; margin-bottom:20px;">
                    <i class="fas fa-key"></i> Change Password
                </h3>
                
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="oldPass" placeholder="Enter current password">
                </div>
                
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPass" placeholder="Enter new password">
                </div>
                
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPass" placeholder="Re-enter new password">
                </div>
                
                <button class="btn btn-add" style="width:100%; padding:15px;" onclick="changePassword()">Update Password</button>
            </div>
        </div>

    </div>

    <div class="modal" id="achModal">
        <div class="modal-body">
            <h3 id="modalTitle">New Achievement</h3>
            <form id="achForm">
                <input type="hidden" id="editId">
                <input type="text" id="title" placeholder="Achievement Title" required>
                <select id="category">
                    <option value="Certificate">Certificate</option>
                    <option value="Internship">Internship</option>
                    <option value="Competition">Competition</option>
                </select>
                <textarea id="desc" rows="2" placeholder="Short Description"></textarea>
                <input type="date" id="date" required>
                
                <div style="margin: 10px 0;">
                    <label style="font-size: 14px;"><input type="checkbox" id="hasFile" onchange="toggleFileField()"> I want to upload a document</label>
                </div>
                
                <div id="fileField" class="hidden">
                    <input type="file" id="fileInput" accept="image/*,application/pdf">
                    <small id="fileInfo" style="color: var(--primary); display:block; margin-top:5px;"></small>
                </div>

                <div style="text-align: right; margin-top: 15px;">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-add">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!--script>
        const API_URL = "http://localhost:5000";
        const myRollNo = localStorage.getItem('username');
        let data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
        let currentView = 'All';

        async function loadProfile() {
            if (!myRollNo) return window.location.href = "login.html";
            try {
                const [sRes, fRes] = await Promise.all([fetch(`${API_URL}/students`), fetch(`${API_URL}/faculty`)]);
                const students = await sRes.json();
                const faculty = await fRes.json();
                const me = students.find(s => String(s.rollNo) === String(myRollNo));
                if (me) {
                    document.getElementById('studentName').innerText = me.name;
                    document.getElementById('studentDetails').innerText = `${me.dept} | Sem ${me.sem} | Roll: ${me.rollNo}`;
                    document.getElementById('profilePic').src = `https://ui-avatars.com/api/?name=${me.name}&background=2563eb&color=fff`;
                    const p = faculty.find(f => f._id === me.proctorId);
                    document.getElementById('proctorName').innerText = p ? `Proctor: ${p.name}` : "No Proctor Assigned";
                }
            } catch (e) { console.error(e); }
        }

        function render() {
            const list = document.getElementById('dataTable');
            const searchTerm = document.getElementById('tableSearch').value.toLowerCase();
            
            const filtered = data.filter(i => {
                const matchesCat = currentView === 'All' || i.category === currentView;
                const matchesSearch = i.title.toLowerCase().includes(searchTerm) || i.category.toLowerCase().includes(searchTerm);
                return matchesCat && matchesSearch;
            });

            list.innerHTML = filtered.map(item => `
                <tr>
                    <td><strong>${item.title}</strong><br><small style="color:#64748b">${item.desc || ''}</small></td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td>
                        ${item.fileData ? `
                            <button class="action-btn btn-view" title="View" onclick="viewFile('${item.id}')"><i class="fas fa-eye"></i></button>
                            <button class="action-btn btn-download" title="Download" onclick="downloadFile('${item.id}')"><i class="fas fa-download"></i></button>
                        ` : '<span style="color:#94a3b8">No File</span>'}
                    </td>
                    <td>
                        <button class="action-btn btn-edit" title="Edit" onclick="editAchievement('${item.id}')"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-delete" title="Delete" onclick="deleteAchievement('${item.id}')"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `).join('');
            updateStats();
            localStorage.setItem(`achievements_${myRollNo}`, JSON.stringify(data));
        }

        // --- FILE SYSTEM ---
        function toggleFileField() {
            document.getElementById('fileField').classList.toggle('hidden', !document.getElementById('hasFile').checked);
        }

        function viewFile(id) {
            const item = data.find(i => i.id == id);
            if (!item || !item.fileData) return alert("File not found");
            const win = window.open();
            win.document.write(`<iframe src="${item.fileData}" frameborder="0" style="width:100%; height:100%;" allowfullscreen></iframe>`);
        }

        function downloadFile(id) {
            const item = data.find(i => i.id == id);
            if (!item || !item.fileData) return alert("File not found");
            const link = document.createElement("a");
            link.href = item.fileData;
            link.download = `${item.title}_Certificate`;
            link.click();
        }

        // --- CRUD OPS ---
        function openModal() {
            document.getElementById('achForm').reset();
            document.getElementById('editId').value = "";
            document.getElementById('modalTitle').innerText = "New Achievement";
            document.getElementById('fileField').classList.add('hidden');
            document.getElementById('fileInfo').innerText = "";
            document.getElementById('achModal').style.display = 'flex';
        }

        function editAchievement(id) {
            const item = data.find(i => i.id == id);
            if (!item) return;
            document.getElementById('editId').value = item.id;
            document.getElementById('title').value = item.title;
            document.getElementById('category').value = item.category;
            document.getElementById('desc').value = item.desc;
            document.getElementById('date').value = item.date;
            document.getElementById('modalTitle').innerText = "Edit Achievement";
            
            const hasFile = !!item.fileData;
            document.getElementById('hasFile').checked = hasFile;
            document.getElementById('fileField').classList.toggle('hidden', !hasFile);
            document.getElementById('fileInfo').innerText = hasFile ? "Document already attached. Re-upload to change." : "";
            document.getElementById('achModal').style.display = 'flex';
        }

        document.getElementById('achForm').onsubmit = async function(e) {
            e.preventDefault();
            const editId = document.getElementById('editId').value;
            const fileInput = document.getElementById('fileInput');
            let fileData = editId ? data.find(i => i.id == editId).fileData : null;

            if (document.getElementById('hasFile').checked && fileInput.files[0]) {
                fileData = await new Promise(res => {
                    const r = new FileReader();
                    r.onload = () => res(r.result);
                    r.readAsDataURL(fileInput.files[0]);
                });
            } else if (!document.getElementById('hasFile').checked) {
                fileData = null;
            }

            const obj = {
                id: editId || Date.now(),
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                desc: document.getElementById('desc').value,
                date: document.getElementById('date').value,
                fileData: fileData
            };

            if (editId) {
                const idx = data.findIndex(i => i.id == editId);
                data[idx] = obj;
            } else {
                data.unshift(obj);
            }
            render();
            closeModal();
        }

        function deleteAchievement(id) {
            if (confirm("Delete this?")) { data = data.filter(i => i.id != id); render(); }
        }

        function updateStats() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        function showCategory(cat, btn) {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('security-view').classList.add('hidden');
            document.getElementById('currentCategoryTitle').innerText = cat === 'All' ? 'All Records' : cat + 's';
            render();
        }

        function toggleSecurityView(btn) {
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('security-view').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('achModal').style.display = 'none'; }
        function logout() { localStorage.clear(); window.location.href = "login.html"; }

        window.onload = () => { loadProfile(); render(); };

        // --- PASSWORD RESET LOGIC ---
        async function changePassword() {
            const oldPass = document.getElementById('oldPass').value;
            const newPass = document.getElementById('newPass').value;
            const confirmPass = document.getElementById('confirmPass').value;

            if(!oldPass || !newPass) return alert("Please fill all fields");
            if(newPass !== confirmPass) return alert("New passwords do not match!");

            try {
                // 1. Verify Old Password
                const verifyRes = await fetch(`${API_URL}/login`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: myRollNo, password: oldPass, role: 'student' })
                });

                if(!verifyRes.ok) return alert("Incorrect Current Password!");

                // 2. Update to New Password
                const updateRes = await fetch(`${API_URL}/admin/update-user`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: myRollNo, password: newPass })
                });

                if(updateRes.ok) {
                    alert("Password Changed Successfully! Please Login again.");
                    logout();
                } else {
                    alert("Failed to update password.");
                }
            } catch(e) { alert("Server Error"); }
        }

    </script-->
<!--script>
    const API_URL = "http://localhost:5000";
        const myRollNo = localStorage.getItem('username');
        let data = []; // We will now fetch this from the DB
        let currentView = 'All';

        // --- FETCH DATA FROM DATABASE ---
        async function loadAchievements() {
            try {
                // Fetching from a custom endpoint. 
                // Note: Ensure your backend has a route for /achievements/:rollNo
                const res = await fetch(`${API_URL}/achievements/${myRollNo}`);
                if (res.ok) {
                    data = await res.json();
                } else {
                    // Fallback to localStorage if DB fetch fails for first-time users
                    data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
                }
                render();
            } catch (e) {
                console.error("Database connection failed, using local storage:", e);
                data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
                render();
            }
        }

        async function loadProfile() {
            if (!myRollNo) return window.location.href = "login.html";
            try {
                const [sRes, fRes] = await Promise.all([fetch(`${API_URL}/students`), fetch(`${API_URL}/faculty`)]);
                const students = await sRes.json();
                const faculty = await fRes.json();
                const me = students.find(s => String(s.rollNo) === String(myRollNo));
                if (me) {
                    document.getElementById('studentName').innerText = me.name;
                    document.getElementById('studentDetails').innerText = `${me.dept} | Sem ${me.sem} | Roll: ${me.rollNo}`;
                    document.getElementById('profilePic').src = `https://ui-avatars.com/api/?name=${me.name}&background=2563eb&color=fff`;
                    const p = faculty.find(f => f._id === me.proctorId);
                    document.getElementById('proctorName').innerText = p ? `Proctor: ${p.name}` : "No Proctor Assigned";
                }
            } catch (e) { console.error(e); }
        }

        function render() {
            const list = document.getElementById('dataTable');
            const searchTerm = document.getElementById('tableSearch').value.toLowerCase();
            
            const filtered = data.filter(i => {
                const matchesCat = currentView === 'All' || i.category === currentView;
                const matchesSearch = i.title.toLowerCase().includes(searchTerm) || i.category.toLowerCase().includes(searchTerm);
                return matchesCat && matchesSearch;
            });

            list.innerHTML = filtered.map(item => `
                <tr>
                    <td><strong>${item.title}</strong><br><small style="color:#64748b">${item.desc || ''}</small></td>
                    <td>${item.category}</td>
                    <td>${item.date}</td>
                    <td>
                        ${item.fileData ? `
                            <button class="action-btn btn-view" title="View" onclick="viewFile('${item.id}')"><i class="fas fa-eye"></i></button>
                            <button class="action-btn btn-download" title="Download" onclick="downloadFile('${item.id}')"><i class="fas fa-download"></i></button>
                        ` : '<span style="color:#94a3b8">No File</span>'}
                    </td>
                    <td>
                        <button class="action-btn btn-edit" title="Edit" onclick="editAchievement('${item.id}')"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-delete" title="Delete" onclick="deleteAchievement('${item.id}')"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            `).join('');
            updateStats();
        }

        // --- SAVE TO DATABASE ---
        document.getElementById('achForm').onsubmit = async function(e) {
    e.preventDefault();
    const editId = document.getElementById('editId').value;
    const fileInput = document.getElementById('fileInput');
    let fileBase64 = null;

    if (document.getElementById('hasFile').checked && fileInput.files[0]) {
        fileBase64 = await new Promise(res => {
            const r = new FileReader();
            r.onload = () => res(r.result);
            r.readAsDataURL(fileInput.files[0]);
        });
    }

    // Prepare data to match AchievementSchema
    const achievementObj = {
        studentRoll: myRollNo,
        studentName: document.getElementById('studentName').innerText,
        proctorId: localStorage.getItem('myProctorId'), // Ensure this was saved during profile load
        title: document.getElementById('title').value,
        category: document.getElementById('category').value,
        description: document.getElementById('desc').value,
        date: document.getElementById('date').value,
        fileData: fileBase64
    };

    try {
        const response = await fetch(`${API_URL}/achievements/add`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(achievementObj)
        });

        if (response.ok) {
            alert("Saved to Database!");
            location.reload(); // Refresh to show new data from DB
        } else {
            throw new Error("DB Save Failed");
        }
    } catch (error) {
        console.error(error);
        alert("Failed to save to database. Check if server is running.");
    }
};

        function saveLocally(obj, editId) {
            if (editId) {
                const idx = data.findIndex(i => i.id == editId);
                data[idx] = obj;
            } else {
                data.unshift(obj);
            }
            localStorage.setItem(`achievements_${myRollNo}`, JSON.stringify(data));
            render();
            closeModal();
        }

        async function deleteAchievement(id) {
            if (confirm("Delete this?")) {
                try {
                    const res = await fetch(`${API_URL}/achievements/${id}`, { method: "DELETE" });
                    if (res.ok) {
                        loadAchievements();
                    }
                } catch (e) {
                    data = data.filter(i => i.id != id);
                    localStorage.setItem(`achievements_${myRollNo}`, JSON.stringify(data));
                    render();
                }
            }
        }

        // --- REMAINING HELPER FUNCTIONS ---
        function toggleFileField() {
            document.getElementById('fileField').classList.toggle('hidden', !document.getElementById('hasFile').checked);
        }

        function viewFile(id) {
            const item = data.find(i => i.id == id);
            if (!item || !item.fileData) return alert("File not found");
            const win = window.open();
            win.document.write(`<iframe src="${item.fileData}" frameborder="0" style="width:100%; height:100%;" allowfullscreen></iframe>`);
        }

        function downloadFile(id) {
            const item = data.find(i => i.id == id);
            if (!item || !item.fileData) return alert("File not found");
            const link = document.createElement("a");
            link.href = item.fileData;
            link.download = `${item.title}_Certificate`;
            link.click();
        }

        function openModal() {
            document.getElementById('achForm').reset();
            document.getElementById('editId').value = "";
            document.getElementById('modalTitle').innerText = "New Achievement";
            document.getElementById('fileField').classList.add('hidden');
            document.getElementById('achModal').style.display = 'flex';
        }

        function editAchievement(id) {
            const item = data.find(i => i.id == id);
            if (!item) return;
            document.getElementById('editId').value = item.id;
            document.getElementById('title').value = item.title;
            document.getElementById('category').value = item.category;
            document.getElementById('desc').value = item.desc;
            document.getElementById('date').value = item.date;
            document.getElementById('modalTitle').innerText = "Edit Achievement";
            const hasFile = !!item.fileData;
            document.getElementById('hasFile').checked = hasFile;
            document.getElementById('fileField').classList.toggle('hidden', !hasFile);
            document.getElementById('achModal').style.display = 'flex';
        }

        function updateStats() {
            document.getElementById('cnt-all').innerText = data.length;
            document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
            document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
            document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
        }

        function showCategory(cat, btn) {
            currentView = cat;
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('security-view').classList.add('hidden');
            document.getElementById('currentCategoryTitle').innerText = cat === 'All' ? 'All Records' : cat + 's';
            render();
        }

        function toggleSecurityView(btn) {
            document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('security-view').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('achModal').style.display = 'none'; }
        function logout() { localStorage.clear(); window.location.href = "login.html"; }

        // --- ON INITIAL LOAD ---
        window.onload = () => { 
            loadProfile(); 
            loadAchievements(); 
        };
</script-->

<script>
    const API_URL = "http://localhost:5000";
    const myRollNo = localStorage.getItem('username');
    let data = []; 
    let currentView = 'All';

    // --- FETCH DATA FROM DATABASE ---
    async function loadAchievements() {
        try {
            const res = await fetch(`${API_URL}/achievements?rollNo=${myRollNo}`); // Fixed URL parameter
            if (res.ok) {
                data = await res.json();
            } else {
                data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
            }
            render(); // This ensures the table updates once data is fetched
        } catch (e) {
            console.error("Database connection failed, using local storage:", e);
            data = JSON.parse(localStorage.getItem(`achievements_${myRollNo}`)) || [];
            render();
        }
    }

    async function loadProfile() {
        if (!myRollNo) return window.location.href = "login.html";
        try {
            const [sRes, fRes] = await Promise.all([fetch(`${API_URL}/students`), fetch(`${API_URL}/faculty`)]);
            const students = await sRes.json();
            const faculty = await fRes.json();
            const me = students.find(s => String(s.rollNo) === String(myRollNo));
            if (me) {
                document.getElementById('studentName').innerText = me.name;
                document.getElementById('studentDetails').innerText = `${me.dept} | Sem ${me.sem} | Roll: ${me.rollNo}`;
                document.getElementById('profilePic').src = `https://ui-avatars.com/api/?name=${me.name}&background=2563eb&color=fff`;
                
                // CRITICAL: Save Proctor ID to localStorage so achievement upload can use it
                if(me.proctorId) localStorage.setItem('myProctorId', me.proctorId);
                
                const p = faculty.find(f => f._id === me.proctorId);
                document.getElementById('proctorName').innerText = p ? `Proctor: ${p.name}` : "No Proctor Assigned";
            }
        } catch (e) { console.error(e); }
    }

    function render() {
        const list = document.getElementById('dataTable');
        const searchTerm = document.getElementById('tableSearch') ? document.getElementById('tableSearch').value.toLowerCase() : "";
        
        const filtered = data.filter(i => {
            const matchesCat = currentView === 'All' || i.category === currentView;
            const matchesSearch = i.title.toLowerCase().includes(searchTerm) || i.category.toLowerCase().includes(searchTerm);
            return matchesCat && matchesSearch;
        });

        list.innerHTML = filtered.map(item => `
            <tr>
                <td><strong>${item.title}</strong><br><small style="color:#64748b">${item.description || item.desc || ''}</small></td>
                <td>${item.category}</td>
                <td>${item.date}</td>
                <td>
                    ${item.fileData ? `
                        <button class="action-btn btn-view" title="View" onclick="viewFile('${item._id}')"><i class="fas fa-eye"></i></button>
                        <button class="action-btn btn-download" title="Download" onclick="downloadFile('${item._id}')"><i class="fas fa-download"></i></button>
                    ` : '<span style="color:#94a3b8">No File</span>'}
                </td>
                <td>
                    <button class="action-btn btn-edit" title="Edit" onclick="editAchievement('${item._id}')"><i class="fas fa-edit"></i></button>
                    <button class="action-btn btn-delete" title="Delete" onclick="deleteAchievement('${item._id}')"><i class="fas fa-trash-alt"></i></button>
                </td>
            </tr>
        `).join('');
        updateStats();
    }

    // --- SAVE TO DATABASE ---
    document.getElementById('achForm').onsubmit = async function(e) {
        e.preventDefault();
        const editId = document.getElementById('editId').value;
        const fileInput = document.getElementById('fileInput');
        let fileBase64 = null;

        // If editing, try to keep the old file if no new one is selected
        if (editId) {
            const existing = data.find(i => i._id === editId);
            if (existing) fileBase64 = existing.fileData;
        }

        if (document.getElementById('hasFile').checked && fileInput.files[0]) {
            fileBase64 = await new Promise(res => {
                const r = new FileReader();
                r.onload = () => res(r.result);
                r.readAsDataURL(fileInput.files[0]);
            });
        }

        const achievementObj = {
            id: editId, // Used by server for findByIdAndUpdate
            studentRoll: myRollNo,
            studentName: document.getElementById('studentName').innerText,
            proctorId: localStorage.getItem('myProctorId'),
            title: document.getElementById('title').value,
            category: document.getElementById('category').value,
            description: document.getElementById('desc').value,
            date: document.getElementById('date').value,
            fileData: fileBase64
        };

        try {
            const endpoint = editId ? `${API_URL}/achievements/verify` : `${API_URL}/achievements/add`; 
            // Note: Check your server.js if edit has a specific route. Usually it's a PUT request.
            
            const response = await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(achievementObj)
            });

            if (response.ok) {
                alert("Success!");
                closeModal();
                loadAchievements(); // Refresh list from DB
            } else {
                throw new Error("DB Save Failed");
            }
        } catch (error) {
            console.error(error);
            alert("Database Error. Check server console.");
        }
    };

    async function deleteAchievement(id) {
        if (confirm("Are you sure you want to delete this achievement?")) {
            try {
                // Adjusting to common delete pattern: API_URL/achievements/ID
                const res = await fetch(`${API_URL}/students/${id}`, { method: "DELETE" }); 
                // WARNING: Your server code currently has app.delete("/students/:id"). 
                // You should ensure you have app.delete("/achievements/:id") in server.js
                
                if (res.ok) {
                    alert("Deleted successfully");
                    loadAchievements();
                } else {
                    alert("Delete failed on server.");
                }
            } catch (e) {
                console.error("Delete error:", e);
            }
        }
    }

    // --- HELPER FUNCTIONS ---
    function viewFile(id) {
        const item = data.find(i => i._id == id);
        if (!item || !item.fileData) return alert("File not found");
        const win = window.open();
        win.document.write(`<iframe src="${item.fileData}" frameborder="0" style="width:100%; height:100%;" allowfullscreen></iframe>`);
    }

    function downloadFile(id) {
        const item = data.find(i => i._id == id);
        if (!item || !item.fileData) return alert("File not found");
        const link = document.createElement("a");
        link.href = item.fileData;
        link.download = `${item.title}_Certificate`;
        link.click();
    }

    function editAchievement(id) {
        const item = data.find(i => i._id == id);
        if (!item) return;
        document.getElementById('editId').value = item._id;
        document.getElementById('title').value = item.title;
        document.getElementById('category').value = item.category;
        document.getElementById('desc').value = item.description || item.desc || "";
        document.getElementById('date').value = item.date;
        document.getElementById('modalTitle').innerText = "Edit Achievement";
        
        const hasFile = !!item.fileData;
        document.getElementById('hasFile').checked = hasFile;
        toggleFileField();
        document.getElementById('achModal').style.display = 'flex';
    }

    function toggleFileField() {
        document.getElementById('fileField').classList.toggle('hidden', !document.getElementById('hasFile').checked);
    }

    function closeModal() { 
        document.getElementById('achModal').style.display = 'none'; 
        document.getElementById('achForm').reset();
    }

    function updateStats() {
        document.getElementById('cnt-all').innerText = data.length;
        document.getElementById('cnt-cert').innerText = data.filter(i => i.category === 'Certificate').length;
        document.getElementById('cnt-int').innerText = data.filter(i => i.category === 'Internship').length;
        document.getElementById('cnt-comp').innerText = data.filter(i => i.category === 'Competition').length;
    }

    function showCategory(cat, btn) {
        currentView = cat;
        document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('dashboard-view').classList.remove('hidden');
        document.getElementById('security-view').classList.add('hidden');
        document.getElementById('currentCategoryTitle').innerText = cat === 'All' ? 'All Records' : cat + 's';
        render();
    }

    function toggleSecurityView(btn) {
        document.querySelectorAll('.menu-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('dashboard-view').classList.add('hidden');
        document.getElementById('security-view').classList.remove('hidden');
    }

    function logout() { localStorage.clear(); window.location.href = "login.html"; }

    window.onload = () => { 
        loadProfile(); 
        loadAchievements(); 
    };
</script>

</body>
</html>